<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Consultar RFID</title>
    <link rel="stylesheet" href="../css/consultar.css">
</head>
<body>
    <div class="container">
        <h1>Consultar RFID</h1>
        <form id="consultarForm">
            <input type="text" name="uid" id="uidField" placeholder="Digite o UID" required>
            <button type="submit">Consultar</button>
        </form>
        <div id="resultado" class="resultado"></div>
        <a href="/" class="back">Voltar</a>
    </div>

    <script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const uidField = document.getElementById('uidField');
const resultado = document.getElementById('resultado');

socket.on('uid-lido', async (data) => {
    uidField.value = data.uid;

    if(data.existe){
        // UID já cadastrado → mostra automaticamente no resultado
        const res = await fetch(`/consultar-uid?uid=${encodeURIComponent(data.uid)}`);
        const json = await res.json();

        resultado.innerHTML = '';
        if(json.status === "sucesso"){
            const registro = json.resultado[0];
            resultado.innerHTML = `
                <div class="card">
                    <h2>${registro.nome}</h2>
                    <p><strong>UID:</strong> ${registro.uid}</p>
                </div>
            `;
        }
    } else {
        // UID não cadastrado → alerta e mantém o campo para cadastro manual
        uidField.readOnly = true;
        resultado.innerHTML = `<p>UID ${data.uid} não cadastrado.</p>`;
    }
});
</script>

</body>
</html>
        