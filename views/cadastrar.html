<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cadastrar RFID</title>
    <link rel="stylesheet" href="../css/cadastrar.css">
</head>
<body>
    <div class="container">
        <h1>Cadastrar RFID</h1>
        <form id="cadastrarForm">
            <input type="text" name="uid" placeholder="UID" id="uidField" required>
            <input type="text" name="nome" placeholder="Nome" required>
            <button type="submit">Cadastrar</button>
        </form>
        <a href="/" class="back">Voltar</a>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
    const socket = io();
    const uidField = document.getElementById('uidField');

    socket.on('uid-lido', (data) => {
        uidField.value = data.uid;

        if(data.existe){
            // UID já cadastrado → ir para consultar
            window.location.href = `/consultar?uid=${encodeURIComponent(data.uid)}`;
        } else {
            // UID não cadastrado → preencher formulário de cadastro
            uidField.readOnly = true; // impede editar o UID
            alert(`UID ${data.uid} não cadastrado. Complete o nome e clique em cadastrar.`);
        }
    });
    </script>

    <script>
        const form = document.getElementById('cadastrarForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                uid: form.uid.value,
                nome: form.nome.value
            };

            const res = await fetch('/cadastrar', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify(data)
            });

            const text = await res.text();
            alert(text);
            form.reset();
        });
    </script>
</body>
</html>
